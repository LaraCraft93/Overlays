box: shypixie/gentoo

build:
    steps:                
        - script:
            name: Cloning Overlay
            code: |
                git clone https://github.com/ShyPixie/Overlays

        - script:
            name: Checking ebuilds
            code: |
                cd Overlays
                repoman -Sd --without-mask full

        - script:
            name: Installing ebuilds
            code: |
                cd Overlays
                mkdir -p /etc/portage/{repos.conf,package.accept_keywords}
                echo -e "[ShyPixie]\nlocation = $(pwd)\nmasters = gentoo\nauto-sync = no" | tee /etc/portage/repos.conf/shypixie.conf
                echo "*/*::ShyPixie **" | tee /etc/portage/package.accept_keywords/shypixie
                rm -fv /sbin/unix_chkpwd
                emerge -uN --nodeps readline
                emerge -C $(qlist -IC virtual/perl)
                emerge @preserved-rebuild
                emerge -uDN --with-bdeps=y @world
                perl-cleaner --reallyall
                emerge $(find -iname '*.ebuild' | cut -d'/' -f2-3 | awk '!a[$0]++' | awk '{print $0"::ShyPixie"}')
